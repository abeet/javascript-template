<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta http-equiv="Pragma" content="no-cache"/>
<meta http-equiv="Cache-Control" content="no-cache"/>
<meta http-equiv="Expires" content="0"/>
<title>test</title>
<link rel="stylesheet" type="text/css" href="resource/css/els.css"/>
<script type="text/javascript" src="resource/js/els.js"></script>
<script type="text/javascript">
//<![CDATA[
var temp1 = [
    /* 01 */ "                                                                                ",
    /* 02 */ "                                                                                ",
    /* 03 */ "                                                                                ",
    /* 04 */ "                                                                                ",
    /* 05 */ "                                                                                ",
    /* 06 */ "                                                                                ",
    /* 07 */ "                                                                                ",
    /* 08 */ "                                                                                ",
    /* 09 */ "                                                                                ",
    /* 10 */ "                                                                                ",
    /* 11 */ "                                                                                ",
    /* 12 */ "                                                                                ",
    /* 13 */ "                                                                                ",
    /* 14 */ "                                                                                ",
    /* 15 */ "                                                                                ",
    /* 16 */ "                                                                                ",
    /* 17 */ "                                                                                ",
    /* 18 */ "                                                                                ",
    /* 19 */ "                                                                                ",
    /* 20 */ "                                                                                ",
    /* 21 */ "                                                                                ",
    /* 22 */ "                                                                                ",
    /* 23 */ "                                                                                ",
    /* 24 */ "                                                                                ",
    /* 25 */ "                                                                                "
];
var temp2 = [
    /* 01 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 02 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 03 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 04 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 05 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 06 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 07 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 08 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 09 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 10 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 11 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 12 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 13 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 14 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 15 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 16 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 17 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 18 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 19 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 20 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 21 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 22 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 23 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 24 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 25 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890"
];
var temp3 = [
    /* 01 */ "        #################################                                       ",
    /* 02 */ "        #            #                  #                                       ",
    /* 03 */ "        #            # Speed: 8888888888#                                       ",
    /* 04 */ "        #            # Score: 8888888888#                                       ",
    /* 05 */ "        #            #                  #                                       ",
    /* 06 */ "        #            #                  #                                       ",
    /* 07 */ "        #            #                  #                                       ",
    /* 08 */ "        #            #                  #                                       ",
    /* 09 */ "        #            # Next             #                                       ",
    /* 10 */ "        #            # 1111             #                                       ",
    /* 11 */ "        #            # 1111             #                                       ",
    /* 12 */ "        #            # 1111             #                                       ",
    /* 13 */ "        #            #                  #                                       ",
    /* 14 */ "        #            #                  #                                       ",
    /* 15 */ "        #            #                  #                                       ",
    /* 16 */ "        #            #                  #                                       ",
    /* 17 */ "        #            # Hurry up!        #                                       ",
    /* 18 */ "        #            #                  #                                       ",
    /* 19 */ "        #            #                  #                                       ",
    /* 20 */ "        #################################                                       ",
    /* 21 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 22 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 23 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 24 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890",
    /* 25 */ "12345678901234567890123456789012345678901234567890123456789012345678901234567890"
];

var Cursor = function(object){
    this.object = object;
};

Cursor.prototype.setColor = function(){};

Cursor.prototype.getPosition = function(){
    var object = this.object;
    var data = {text: "", start: 0, end: 0};
    try{object.focus();}catch(e){}

    if(object.setSelectionRange)
    {
        data.start= object.selectionStart;
        data.end = object.selectionEnd;
        data.text = (data.start != data.end) ? object.value.substring(object.start, object.end): "";
    }
    else if(document.selection)
    {
        var i = 0;
        var oS = document.selection.createRange();
        var oR = document.body.createTextRange();
        oR.moveToElementText(object);
        data.text = oS.text;
        data.bookmark = oS.getBookmark();

        for(i = 0; oR.compareEndPoints("StartToStart", oS) < 0 && oS.moveStart("character", -1) !== 0; i++)
        {
            if(object.value.charAt(i) == "/n")
            {
                i++;
            }
        }

        data.start = i;
        data.end = data.text.length + data.start;
    }

    object.setAttribute("cursorPosition", data.start);
    return data;
};

Cursor.prototype.setPosition = function(x, y){
    if(document.all)
    {
        var position = (x - 1) * 80 + x + y - 2;
        var range = this.object.createTextRange();
        range.moveStart("character", position);
        range.collapse(true);
        range.select();
    }
    else
    {
        this.object.select();
        this.object.selectionStart = x;
        this.object.selectionEnd = y;
    }
};

Cursor.prototype.write = function(text){
    var value = this.object.value;
    var position = this.getPosition();
    var start = position.start;

    try
    {
        object.focus();
    }
    catch(e)
    {
    }

    var selection = document.selection;

    if(this.object.selectionStart != null)
    {
        var end = this.object.selectionEnd;
        this.object.value = this.object.value.substring(0, start) + text + this.object.value.substring(end);
        this.object.selectionStart = start + text.length;
        this.object.selectionEnd = start + text.length;

    }
    else if(selection && selection.createRange)
    {
        var end = start - 2000 + text.length - Math.floor((2000 - start) / 80);
        var range = this.object.createTextRange();
        range.moveStart("character", start);
        range.moveEnd("character", start - 2000 + text.length - Math.floor((2000 - start) / 80));
        range.select();
        range.text = text;
    }
};

var cursor = null;

/**
 * @Override
 */
E.prototype.baseX = 23;
E.prototype.baseY = 1;

/**
 * @Override
 */
E.prototype.create = function(){
    this.clear();
    var pool = [
        "        #################################                                       ",
        "        #            #                  #                                       ",
        "        #            # Speed: 8888888888#                                       ",
        "        #            # Score: 8888888888#                                       ",
        "        #            #                  #                                       ",
        "        #            #                  #                                       ",
        "        #            #                  #                                       ",
        "        #            #                  #                                       ",
        "        #            # Next             #                                       ",
        "        #            # 1111             #                                       ",
        "        #            # 1111             #                                       ",
        "        #            # 1111             #                                       ",
        "        #            #                  #                                       ",
        "        #            #                  #                                       ",
        "        #            #                  #                                       ",
        "        #            #                  #                                       ",
        "        #            # Hurry up!        #                                       ",
        "        #            #                  #                                       ",
        "        #            #                  #                                       ",
        "        #################################                                       "
    ];

    document.getElementById("mytextarea").value = temp3.join("\r\n");

    // this.setSpeed(0);
    // this.setScore(0);
    // this.info("Hurry up !");
};

/**
 * @Override
 */
E.prototype.clear = function(){
    for(var i = 1; i <= 25; i++)
    {
        cursor.setPosition(1, i);
        cursor.write("                                                                                ");
    }
};

/**
 * @Override
 */
E.prototype.setSpeed = function(speed){
    cursor.setPosition(this.baseX + 15, this.baseY + 2);
    cursor.write("                 ");
    cursor.setPosition(this.baseX + 15, this.baseY + 2);
    cursor.write("Speed: " + speed);
};

/**
 * @Override
 */
E.prototype.setScore = function(score){
    cursor.setPosition(this.baseX + 15, this.baseY + 3);
    cursor.write("                 ");
    cursor.setPosition(this.baseX + 15, this.baseY + 3);
    cursor.write("Score: " + score);
};

/**
 * @Override
 */
E.prototype.info = function(text){
    cursor.setPosition(this.baseX + 15, this.baseY + 16);
    cursor.write("                 ");
    cursor.setPosition(this.baseX + 15, this.baseY + 16);
    cursor.write(text);
};

/**
 * @Override
 */
E.prototype.copy = function(i, j){
    var ri = this.toBinaryString(this.p[i]);
    var rj = this.toBinaryString(this.p[j]);
    cursor.setPosition(this.baseX + 1, this.baseY + i + 1);
    cursor.write(ri.substring(3, 15).replace(/0/g, " "));
    cursor.setPosition(this.baseX + 1, this.baseY + j + 1);
    cursor.write(rj.substring(3, 15).replace(/0/g, " "));
};

/**
 * @Override
 */
E.prototype.setVisible = function(i, j, color){
    cursor.setPosition(this.baseX + j + 1, this.baseY + i + 1);

    if(color == this.bgcolor)
    {
        cursor.write(" ");
    }
    else
    {
        cursor.setColor(color);
        cursor.write("1");
    }
};

/**
 * @Override
 */
E.prototype.setNextVisible = function(i, j, color, text){
    cursor.setPosition(this.baseX + j + 15, this.baseY + i + 9);

    if(color == this.bgcolor)
    {
        cursor.write(" ");
    }
    else
    {
        cursor.setColor(color);
        cursor.write("1");
    }
};

window.onload = function()
{
    var debug = 1;
    cursor = new Cursor(document.getElementById("mytextarea"));
    var e = new E();
    e.colors = ["b1", "b2", "b3", "b4", "b5", "b6", "b7"];
    e.bgcolor = "b0";

    if(debug == 1)
    {
        e.create();

        document.onkeydown = (function(target, method){
            return function(e){
                method.apply(target, [(e || window.event), 0]);
            };
        })(e, e.event);
    }
    else
    {
        document.getElementById("mytextarea").value = temp3.join("\r\n");
        cursor.setPosition(1, 1);
    }
};

function test()
{
    var x = parseInt(document.getElementById("posX").value);
    var y = parseInt(document.getElementById("posY").value);
    cursor.setPosition(x, y);
    cursor.write("HaHaHa");
}
//]]>
</script>
</head>
<body>
<div>
    <textarea id="mytextarea" style="width: 800px; height: 400px;"></textarea>
</div>
<div>
    <input id="posX" type="text" style="width: 60px;" value="1"/>
    <input id="posY" type="text" style="width: 60px;" value="5"/>
    <input type="button" value="test" onclick="test()"/>
</div>
</body>
</html>
